#!/usr/bin/env python
'''Move SConstruct into place and similar build setup steps'''

import os
import sys

build = os.path.realpath(os.path.abspath(os.path.dirname(__file__)))

def link(src,dst=None):
  if not dst:
    dst = os.path.basename(src)
  if not os.path.exists(dst):
    print 'ln -s %s %s'%(src,dst)
    os.symlink(src,dst)

def move(src,dst):
  print 'mv %s %s'%(src,dst)
  os.rename(src,dst)

# Rename SConstruct.options or config.py to core/build/config.py
config = os.path.join(build,'config.py')
for bad in 'SConstruct.options','config.py':
  if os.path.exists(bad):
    if os.path.islink(bad):
      print 'rm %s'%bad
      os.remove(bad)
    elif os.path.exists(config):
      print>>sys.stderr, 'Both %s and %s exist.  They should be merged into %s.'%(bad,config,config)
      sys.exit(1)
    else:
      move(bad,config)

# Touch core/build/config.py
if not os.path.exists(config):
  print 'touch %s'%config
  open(config,'a')

# Add symlinks
link(os.path.join(build,'SConstruct'))
link(os.path.join(build,'config.py'))
link(os.path.join(build,'setup.cfg'))
